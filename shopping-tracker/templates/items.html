<body>
    <h1>Shopping List</h1>

    <ul id="item-list"></ul>

    <h2>Add Item</h2>
    <form id="item-form">
        <input type="text" id="name" placeholder="Item name" required>
        <input type="number" id="quantity" placeholder="Quantity" value="1">
        <input type="checkbox" id="needed" checked> Needed<br>

        <!-- Category dropdown -->
        <select id="category_id" required>
            <option value="">Select Category</option>
        </select>

        <!-- Shop dropdown -->
        <select id="shop_id" required>
            <option value="">Select Shop</option>
        </select>

        <button type="submit">Add Item</button>
    </form>

    <!-- Add Category Form -->
<h3>Add Category</h3>
<form id="category-form">
    <input type="text" id="new-category-name" placeholder="New category name" required>
    <button type="submit">Add Category</button>
</form>

<!-- Add Shop Form -->
<h3>Add Shop</h3>
<form id="shop-form">
    <input type="text" id="new-shop-name" placeholder="New shop name" required>
    <input type="text" id="new-shop-location" placeholder="Shop location">
    <button type="submit">Add Shop</button>
</form>

    <script>
        async function loadItems() {
            const res = await fetch('/api/items');
            const items = await res.json();
            const list = document.getElementById('item-list');
            list.innerHTML = '';

            items.forEach(item => {
                const li = document.createElement('li');
                li.textContent = `${item.name} (${item.quantity}) - ${item.category} from ${item.shop} `;

                const delBtn = document.createElement('button');
                delBtn.textContent = 'ðŸ—‘ï¸ Delete';
                delBtn.style.marginLeft = '10px';
                delBtn.onclick = async () => {
                    await fetch(`/api/items/${item.id}`, { method: 'DELETE' });
                    loadItems();
                };

                li.appendChild(delBtn);
                list.appendChild(li);
            });
        }

        async function loadCategories() {
            const res = await fetch('/api/categories');
            const categories = await res.json();
            const select = document.getElementById('category_id');
            categories.forEach(cat => {
                const option = document.createElement('option');
                option.value = cat.id;
                option.textContent = cat.name;
                select.appendChild(option);
            });
        }

        async function loadShops() {
            const res = await fetch('/api/shops');
            const shops = await res.json();
            const select = document.getElementById('shop_id');
            shops.forEach(shop => {
                const option = document.createElement('option');
                option.value = shop.id;
                option.textContent = shop.name;
                select.appendChild(option);
            });
        }

        loadItems();
        loadCategories();
        loadShops();

        document.getElementById('item-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            const item = {
                name: document.getElementById('name').value,
                quantity: parseInt(document.getElementById('quantity').value),
                needed: document.getElementById('needed').checked,
                category_id: parseInt(document.getElementById('category_id').value),
                shop_id: parseInt(document.getElementById('shop_id').value)
            };
            await fetch('/api/items', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify(item)
            });
            loadItems();
            e.target.reset();
        });
    </script>
</body>
